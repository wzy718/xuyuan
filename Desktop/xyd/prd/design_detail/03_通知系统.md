# 小约定App - 通知系统设计

## 一、通知类型与优先级

### 紧急通知（强提醒）
优先级：P0 - 必须立即送达

#### 触发场景
- 约定即将到期（<2小时）
- 见证人请求紧急确认
- 约定被对方撤销
- 数据同步冲突需要解决

#### 展示方式
- 系统级推送通知
- App内弹窗提醒
- 震动+提示音（如开启）
- 锁屏显示完整内容

### 重要通知（标准提醒）
优先级：P1 - 正常推送

#### 触发场景
- 每日待执行约定提醒
- 定时打卡提醒
- 新约定邀请
- 约定状态变更
- 参与者完成打卡

#### 展示方式
- 标准推送通知
- App内红点提示
- 通知栏展示
- 应用角标数字

### 普通通知（静默推送）
优先级：P2 - 不打扰用户

#### 触发场景
- 其他参与者的日常打卡
- 见证人评论点赞
- 周/月度报告生成
- 系统活动推荐
- 版本更新提示

#### 展示方式
- 仅App内消息中心展示
- 不推送到系统通知
- 不显示角标
- 用户主动查看

## 二、通知设置页面

### 全局设置

#### 主开关
- 一键开启/关闭所有通知
- 关闭后仅保留紧急通知
- 状态本地+云端同步

#### 免打扰时段
- **工作日设置**：
  - 默认：23:00-7:00
  - 自定义时间段
  - 午休时段（可选）
- **周末设置**：
  - 可单独设置
  - 继承工作日设置选项
- **临时静音**：
  - 1小时
  - 4小时
  - 今天
  - 自定义时长

#### 通知样式
- **系统层面**：
  - 横幅显示
  - 通知中心
  - 锁屏显示
- **提醒方式**：
  - 声音（可选铃声）
  - 振动（可调强度）
  - LED灯（如支持）
- **应用内**：
  - 角标显示
  - 红点提示
  - 浮窗通知

### 分类设置

#### 按约定类型
- **情侣约定**：
  - 专属提示音：甜蜜音效
  - 图标：粉色心形
  - 优先级：可调整
- **亲子任务**：
  - 专属提示音：温馨音效
  - 图标：家庭图标
  - 时段限制：避免打扰孩子学习
- **自律目标**：
  - 专属提示音：激励音效
  - 语音播报：完成进度
  - 正向激励文案
- **群体约定**：
  - @提醒机制
  - 群组消息聚合
  - 重要度标记

#### 按紧急程度
- **紧急通知**：
  - 强制推送（免打扰时段除外）
  - 电话提醒（需额外授权）
  - 重复提醒（间隔5分钟）
- **重要通知**：
  - 标准推送
  - 应用内红点
  - 消息中心置顶
- **普通通知**：
  - 仅应用内提示
  - 批量展示
  - 定期清理

#### 按参与角色
- **发起者专属**：
  - 全程跟踪通知
  - 参与者状态变更
  - 执行异常预警
- **参与者专属**：
  - 执行相关通知
  - 打卡提醒
  - 完成确认
- **见证人专属**：
  - 验证请求通知
  - 到期提醒
  - 争议处理请求

### 智能通知管理

#### 通知聚合
- **聚合规则**：
  - 相同类型5分钟内合并
  - 最多聚合10条
  - 保留最重要信息
- **批量处理**：
  - 批量打卡一键完成
  - 批量已读标记
  - 批量删除功能
- **摘要展示**：
  - "您有3个约定待执行"
  - "收到5条见证人反馈"
  - 展开查看详情

#### 智能静音
- **学习用户习惯**：
  - 记录活跃时段
  - 分析使用频率
  - 自动优化推送时机
- **场景识别**：
  - 会议日程自动静音（需日历权限）
  - 地理围栏静音（办公室/家）
  - 驾驶模式识别
- **智能降级**：
  - 频繁忽略自动降级
  - 重要度动态调整
  - 用户反馈学习

#### 个性化时机
- **AI预测最佳时间**：
  - 基于历史打开率
  - 结合完成率分析
  - 避开用户休息时间
- **动态调整策略**：
  - 根据响应速度调整
  - 考虑时区变化
  - 节假日特殊处理
- **效果追踪**：
  - 通知送达率
  - 点击转化率
  - 用户反馈收集

### 通知交互设计

#### 快捷操作
- **3D Touch/长按菜单**：
  - 快速打卡
  - 标记完成
  - 稍后提醒
  - 查看详情
- **滑动操作**：
  - 左滑：删除/标记已读
  - 右滑：查看约定详情
  - 下拉：展开完整内容
- **直接回复**：
  - 回复见证人评论
  - 快速发送完成说明
  - 语音快速回复

#### 富媒体展示
- **进度可视化**：
  - 进度条展示
  - 百分比显示
  - 环形进度图
- **动态更新**：
  - 倒计时实时更新
  - 状态变化动画
  - 数据自动刷新
- **参与者信息**：
  - 头像展示
  - 在线状态
  - 最新动态

#### 历史记录
- **保存策略**：
  - 7天内通知回看
  - 重要通知永久保存
  - 自动清理过期内容
- **状态管理**：
  - 已读/未读状态
  - 重要标记
  - 分类归档
- **操作功能**：
  - 搜索历史通知
  - 筛选特定类型
  - 一键清空功能

## 三、通知模板设计

### 约定创建类
```
💝 小美邀请你加入约定
"每周三起健身打卡"
点击查看详情 >
```

### 执行提醒类
```
⏰ 打卡提醒
"背单词30个"还有2小时到期
立即打卡 >
```

### 完成通知类
```
🎉 恭喜完成！
你已连续7天完成"早起打卡"
查看成就 >
```

### 见证人通知类
```
👀 需要你的见证
小明完成了"跑步5公里"
确认完成 >
```

## 四、推送策略

### 推送时机
- 避开深夜时段（23:00-7:00）
- 优先工作日晚间（19:00-21:00）
- 周末适当延后

### 推送频率
- 每日推送上限：10条
- 紧急通知不限制
- 相同内容去重

### 推送文案
- 个性化称呼
- 积极正向语气
- 简洁明了重点突出
- 包含操作引导

## 五、技术实现

### 推送服务
- iOS：APNs推送
- Android：FCM/厂商通道
- 小程序：模板消息

### 本地通知
- 定时任务提醒
- 离线缓存机制
- 本地数据触发

### 消息队列
- 优先级队列管理
- 失败重试机制
- 去重过滤处理

### 数据统计
- 送达率监控
- 点击率分析
- 用户偏好学习