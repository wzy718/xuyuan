# 主要问题清单与修订建议（Taro + React，含 RN MVP）

> 目标：统一项目文档与当前技术栈（Taro + React），明确 RN 端在 MVP 阶段的替代方案与落地清单，保证跨端一致性与性能达标。

## 一、核心问题清单（What）

1) 工程结构与文档叙述不一致
- 现状：仓库仍含 `xyd_app`（Flutter），Taro 工程目录/脚本未统一暴露。
- 影响：新人落地困难、命令不可用、CI/CD 难以配置。

2) UI 组件库不一致（NutUI 不支持 RN）
- 现状：文档默认 NutUI 作为跨端组件库；RN 端无法复用。
- 影响：RN 端样式与交互不可用/不一致，阻碍 MVP。

3) 构建/运行命令不统一
- 现状：CLAUDE.md 与 docs 多处命令矩阵不一致，缺少 RN 端命令与首次运行说明。
- 影响：开发与文档割裂、脚本失配。

4) 小程序能力口径不完整
- 包体限制、订阅消息（替代模板消息）、WebP 支持与回退策略未系统梳理。
- 影响：发布前踩坑、性能与审核风险。

5) RN 端基础设施未明确
- 导航、动画/手势、长列表、存储、图片缓存、权限等未成体系。
- 影响：性能/体验不可控，重复选型。

6) 图片与占位策略不准确
- 样例将 Taro Image 的 `placeholder` 作为通用属性；WebP 策略未分端。
- 影响：实现偏差、回退策略缺失。

7) 长列表策略分端不清
- Weapp/H5（VirtualList）与 RN（FlashList）未分别指引。
- 影响：性能不达标、滚动抖动。

8) AI 实现差异未标注
- Weapp 云函数/H5 服务端/RN 端侧（原生桥接）复杂度差异未在文档显式声明。
- 影响：需求与技术预期错位。

9) 发布与签名流程缺口（RN）
- RN 打包、签名、Sentry 符号表、推送权限等未入文档。
- 影响：临发布风险高、缺监控。

10) Roadmap 并行项过多
- 同期纳入 RN + 端侧 AI + 小程序云函数，风险偏高。
- 影响：交付节奏不稳，关键指标难以达成。

## 二、修订建议（How）

### 2.1 文件级对照修改表

- `CLAUDE.md`
  - 更新“项目概述/主要平台/技术栈”：主栈 Taro + React；MVP 支持 Weapp/H5/RN。
  - 增补统一命令矩阵：`dev:weapp | dev:h5 | dev:rn | build:weapp | build:h5 | build:rn | lint | test`。
  - 标注目录与迁移状态：建议新增 `app-taro/`（或单仓多包）承载 Taro 工程，保留 Flutter 目录说明。

- `docs/architecture/README.md`
  - 组件库矩阵：Weapp/H5 → NutUI；RN → React Native Paper（或 NativeBase）。
  - 新增“RN 基础设施”小节：React Navigation、Reanimated、Gesture Handler、FlashList、MMKV、FastImage、Permissions。
  - 设计 Token 为主，分别映射到 NutUI 与 Paper/NativeBase 主题。

- `docs/best-practices/README.md`
  - 新增“RN 性能四要点”：长列表、动画、手势、存储。
  - 统一表单/校验与国际化方案：react-hook-form + zod、react-i18next。

- `docs/best-practices/component-design.md`
  - 增补“跨端主题映射规范”：用 Design Token 驱动，避免被组件库特性绑架设计。
  - 强化容器/展示拆分与可测试性（RN 尤其避免巨型页面）。

- `docs/best-practices/performance.md`
  - 分端长列表：Weapp/H5 使用 `@tarojs/components/virtual-list`；RN 使用 FlashList。
  - 图片缓存：RN 使用 react-native-fast-image；H5/Weapp 说明 WebP 与回退策略。
  - 动画/手势初始化：Reanimated Babel 插件与 Gesture Handler 初始化顺序。

- `docs/best-practices/cross-platform.md`
  - 新增“RN 端差异处理”：导航容器、手势优先级、权限封装层（react-native-permissions）。

- `docs/development/README.md`
  - 统一命令矩阵与脚本；新增 RN 首次运行 Checklist（pod install、Gradle、真机调试）。

- `docs/deployment/README.md`
  - 新增 RN 打包/签名与发布；Sentry 符号表上传；可选 CodePush 策略。
  - 小程序包体限制与分包校验 Checklist；订阅消息合规说明。

- `docs/features/README.md`
  - 标注“RN 端组件映射”：Button/Input/Modal/Toast/Skeleton 对应 Paper/NativeBase 组件。

- `docs/development/roadmap.md`
  - 调整优先级：MVP 锚定 RN 基建（导航/主题/长列表/权限/图片缓存/监控），端侧 AI 后置到专项。

- `prd/design_detail/08_AI快速创建流程.md`
  - 在“技术实现要点”补充端差异：Weapp 云函数、H5 服务端、RN 不做端侧推理（MVP），保留后续原生桥接路线。

- 新增 `docs/design-tokens.md`
  - 汇总颜色/字号/间距/圆角/阴影/动效时长与缓动曲线；列出 NutUI 与 Paper 的主题映射示例。

### 2.2 RN 端替代与落地（MVP 必做）

- UI 组件库：React Native Paper（或 NativeBase/Gluestack，择一）
- 导航：React Navigation（Stack + BottomTabs + Deep Link）
- 动画/手势：react-native-reanimated v3 + react-native-gesture-handler
- 长列表：FlashList（Shopify）
- 存储：react-native-mmkv（高性能 KV）
- 表单与校验：react-hook-form + zod
- 图片缓存：react-native-fast-image
- 权限：react-native-permissions
- 图标：react-native-vector-icons
- 媒体/文件：react-native-image-picker、react-native-fs（按需）
- 通知（可选）：notifee + 平台推送（后置接入 FCM/APNs）
- 稳定性监控：@sentry/react-native
- 国际化：react-i18next

> 详见：`prd/design_detail/RN 端替代NutUI 的选型与最佳实践.md`

## 三、分端策略与一致性（Design Token 驱动）

- 统一 Design Token：色板、字号、间距、圆角、阴影、动效（300ms/缓动曲线）。
- Weapp/H5：NutUI 主题按 Token 映射；RN：Paper/NativeBase 主题按 Token 映射。
- 动效与空态/骨架：体验对齐，技术实现可分端（Lottie/Rive/RN Animated/Reanimated）。

## 四、风险与缓解

- 原生依赖碎片化：收敛到头部库，控制数量，预留替代候选。
- 动画/导航初始化陷阱：遵循官方模板顺序，加入启动期自检（开发开关）。
- 包体与构建复杂度：按需引入、分环境开关；小程序分包/总包提前校验。
- 端侧 AI 误期风险：MVP 不做 RN 端侧推理，统一走云函数/服务端。

## 五、验收标准（Checklist）

- 命令矩阵统一，三端均可一键启动与构建。
- RN 端：导航/主题/长列表/权限/图片缓存/错误上报全部跑通。
- 长列表性能：常用机型滚动 60fps，无明显掉帧。
- 图片策略：RN 端 FastImage 命中缓存；Weapp/H5 WebP/回退策略生效。
- 监控：Sentry 事件与崩溃可见，版本符号表上传成功。
- 文档：上述文件修订完毕，新增 design-tokens 文档落地。

---

最后更新：2025-08-09  
维护人：产品/前端联合


