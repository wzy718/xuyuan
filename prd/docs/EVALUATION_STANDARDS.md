# 愿望评价标准与输出规范

本项目的“愿望分析”以 6 个要素为评价标准，并在优化方案中额外提供“建议许愿对象”，由 AI 结合愿望内容动态判断（如学业→文殊、姻缘→月老、犯太岁→太岁），用于引导用户选择更贴合场景的对象。

## 评价标准（6 个要素）

1. 时间边界：是否包含明确时间（如“3 个月内”“2026 年内”等）
2. 可验证的量化目标：是否包含数字和单位（金额、分数、名次、offer 等）
3. 方式与边界：是否包含合法合规、不伤害他人等表述
4. 行动承诺：是否包含“我会/我愿意/每天”等行动表述
5. 还愿/回向：是否包含还愿、回向、布施等表述（可选，但有助于形成闭环）
6. 明确的许愿人：是否包含明确许愿人的名字与身份证号（仅使用占位符，禁止编造真实号码）

## 输出结构（云函数）

### 1）分析阶段（快速诊断）

```json
{
  "analysis_results": ["原因和后果1"],
  "case": "戏剧化失败案例或正向建议",
  "posture": "最关键的改法",
  "suggested_deity": "建议许愿对象",
  "locked": true
}
```

要求：
- `analysis_results`：0-6 条，每条 18 字内；必须逐条对照 6 要素（每缺 1 条最多 1 条原因和后果）
- `analysis_results`：只输出“未满足/缺失/不清晰”的点；已满足或大致符合的要素禁止输出（例如不要出现“时间边界明确/符合要求/信息完整”等通过项表述）
- 若 6 条均满足：`analysis_results=["基本要素齐全，可进一步润色表达"]`，且 `case="表达清晰，建议保持行动承诺并定期复盘"`
- `suggested_deity`：基于愿望内容给出建议对象；无法判断可为空字符串

### 2）解锁后（优化方案）

```json
{
  "full_result": {
    "optimized_text": "可直接复制的许愿稿（80-160字）",
    "structured_suggestion": {
      "suggested_deity": "建议许愿对象",
      "time_range": "时间边界",
      "target_quantify": "量化目标",
      "way_boundary": "方式与边界",
      "action_commitment": "行动承诺",
      "return_wish": "还愿/回向",
      "wisher_info": "许愿人：姓名（身份证号：使用占位符）"
    },
    "steps": ["步骤1", "步骤2", "步骤3"],
    "warnings": ["注意事项1"]
  }
}
```

约束：
- 所有内容避免违法违规、伤害他人、诈骗赌博等
- 身份证号只允许占位符写法：`许愿人：张三（身份证号：使用占位符）`

## 代码入口

- 云函数：`frontend/cloudfunctions/api/index.js`
- 前端展示：`frontend/src/components/AnalysisModal/index.tsx`
